* Personal config
Personal config for NixOS managed with Nix package manager and nix flakes.

#+ATTR_ORG: :width 900
[[file:./images/screenshot.png]]


** Fresh install
*** Ext4
Partitioning is made with /ext4/ file system:

| Partition | Size             |
| UEFI      | 260Mib           |
| root      | rest of the disk |

The root is encrypted with ~cryptsetup~. 

*** BTRFS
Partitioning is made with ~btrfs~ file system, during it a blank two read-only snapshots are taken:
- ~root~
- ~home~

Snapshots are used to erase the disk at every boot in order to obtain a complete immutable and declarative system.

Obviously some data, logs, cache, etc. must survive the boot process, this is achieved using [[https://github.com/nix-community/impermanence][imperamanence]].

TODO: add a link to the zettelkasten note or add the content here.
** System
The system configuration is divided into modules inside the ~system~ directory.

#+begin_src shell :results raw
  exa -T --sort=type system
#+end_src

#+begin_src shell
  system
  ├── hardware-configurations
  │  ├── btrfs.nix
  │  └── ext4.nix
  ├── boot.nix
  ├── configuration.nix
  ├── hardware.nix
  ├── keymapTimeFont.nix
  ├── networking.nix
  ├── nixNixOS.nix
  ├── nvidia.nix
  ├── pipewire.nix
  ├── programsEnv.nix
  ├── security.nix
  ├── services.nix
  └── user.nix
#+end_src


There are two hardware-configurations, for more information about the partitioning please refer to fresh install section:
- ~ext4.nix~, currently used for the XPS 9510.
- ~btrfs.nix~, btrfs with erase on boot (currently WIP).

Files description:
- ~boot.nix~ contains grub settings and some parameters related to early stages of the system.
- ~configuration.nix~ entry point for the system configuration.
- ~hardware.nix~ contains configuration of hardware inside the laptop (audio, bluetooth, thermal management, ...).
- ~keymapTimeFont.nix~ defines the keymap of the keyboard and some settings related to fonts of the system.
- ~networking.nix~ has some networking settings.
- ~nixNixOS.nix~ cotains setup for nix package manager, mainly for nix flake addition.
- ~nvidia.nix~ configuration of nvidia offload mode for /3050ti/ video card inside the laptop.
- ~pipewire.nix~ pipewire configuration required for wayland usage.
- ~programsEnv.nix~ list of packages installed system-wide.
- ~security.nix~ settings related to pam and doas.
- ~user.nix~ user initialization.

** User
User configuration managed with /home-manager/.

*** Directories
#+begin_src shell :results raw
    exa -T --level=1 --only-dirs --sort=type home
#+end_src

#+begin_src shell :results raw
home
├── dotfiles
├── modules
└── sources
#+end_src

Directories description:
- ~dotfiles~: configuration files that can not be integrated inside home-manager.
- ~modules~: nix modules divided into multiple files.
- ~source~: various scripts.

TODO: create a derivation or a patch for [[https://github.com/EliverLara/firefox-nordic-theme][firefox nordic theme]].

** Installation
#+begin_src sh
  ./install.sh
#+end_src

** Keyboards
[[file:./qmk_config/README.org][QMK keyboard firmware]]
